# üöÄ Guide de D√©ploiement - Maison Giel

Ce guide vous accompagne pour d√©ployer votre application sur **GitHub**, **Vercel** (frontend), **Render** (backend) et **Supabase** (base de donn√©es).

---

## üìã Pr√©requis

- [x] Compte GitHub
- [x] Compte Vercel (gratuit)
- [x] Compte Render (gratuit)
- [x] Compte Supabase (gratuit)

---

## 1Ô∏è‚É£ SUPABASE - Base de Donn√©es Cloud

### √âtape 1.1 : Cr√©er le projet Supabase

1. Allez sur [supabase.com](https://supabase.com)
2. Connectez-vous avec GitHub
3. Cr√©ez un nouveau projet :
   - **Name** : `maisongiel-prod`
   - **Database Password** : G√©n√©rez un mot de passe fort et sauvegardez-le
   - **Region** : `Europe (Frankfurt)` ou le plus proche de vos utilisateurs

### √âtape 1.2 : Cr√©er la table `participations`

1. Dans votre projet Supabase, allez dans **SQL Editor**
2. Cliquez sur **New Query**
3. Collez ce code :

```sql
create table participations (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  user_id text,
  name text,
  email text,
  review_link text,
  reward_type text,
  reward_code text,
  reward_used boolean default false
);

-- Index pour am√©liorer les performances
create index idx_participations_email on participations(email);
create index idx_participations_user_id on participations(user_id);
create index idx_participations_reward_code on participations(reward_code);
```

4. Cliquez sur **RUN** (ou `Ctrl + Enter`)

### √âtape 1.3 : R√©cup√©rer les cl√©s API

1. Allez dans **Settings** ‚Üí **API**
2. **Notez ces informations** (vous en aurez besoin pour Render) :
   - `Project URL` : `https://votre-projet.supabase.co`
   - `service_role` key (cliquez sur "Reveal" pour la voir)

‚ö†Ô∏è **IMPORTANT** : La cl√© `service_role` est ultra-secr√®te. Ne la partagez JAMAIS publiquement.

---

## 2Ô∏è‚É£ GITHUB - Versionner le Code

### √âtape 2.1 : Pousser votre code

```bash
cd /Users/g.colas/Desktop/site\ web/travail/maisongiel/siteqrcode

# Initialiser Git (si pas d√©j√† fait)
git init

# Ajouter tous les fichiers (sauf ceux dans .gitignore)
git add .

# Commit
git commit -m "üöÄ Int√©gration Supabase + Pr√™t pour d√©ploiement"

# Cr√©er le repo sur GitHub (si pas d√©j√† fait)
# Allez sur github.com ‚Üí New Repository ‚Üí "maisongiel-qrcode"

# Ajouter l'origin
git remote add origin https://github.com/VOTRE-USERNAME/maisongiel-qrcode.git

# Pousser
git push -u origin main
```

---

## 3Ô∏è‚É£ RENDER - Backend (API Node.js)

### √âtape 3.1 : Cr√©er le service

1. Allez sur [render.com](https://render.com)
2. Connectez-vous avec GitHub
3. Cliquez sur **New +** ‚Üí **Web Service**
4. Connectez votre repo GitHub `maisongiel-qrcode`
5. Configurez :
   - **Name** : `maisongiel-backend`
   - **Region** : `Frankfurt (EU Central)`
   - **Branch** : `main`
   - **Root Directory** : `backend`
   - **Runtime** : `Node`
   - **Build Command** : `npm install`
   - **Start Command** : `npm start`
   - **Plan** : `Free`

### √âtape 3.2 : Configurer les Variables d'Environnement

Dans l'onglet **Environment** de votre service Render, ajoutez ces variables :

```env
NODE_ENV=production
PORT=3000
JWT_SECRET=VOTRE_CLE_JWT_ULTRA_SECRETE_ICI
ADMIN_USERNAME=admin
ADMIN_PASSWORD=VOTRE_MOT_DE_PASSE_ADMIN_FORT
FRONTEND_URL=https://maisongiel.net
SUPABASE_URL=https://votre-projet.supabase.co
SUPABASE_SERVICE_ROLE_KEY=VOTRE_CLE_SERVICE_ROLE_SUPABASE
```

‚ö†Ô∏è Remplacez les valeurs en MAJUSCULES par vos vraies cl√©s !

### √âtape 3.3 : D√©ployer

1. Cliquez sur **Create Web Service**
2. Render va automatiquement d√©ployer votre backend
3. Notez l'URL : `https://maisongiel-backend.onrender.com`

---

## 4Ô∏è‚É£ VERCEL - Frontend (React)

### √âtape 4.1 : Cr√©er le projet

1. Allez sur [vercel.com](https://vercel.com)
2. Connectez-vous avec GitHub
3. Cliquez sur **Add New...** ‚Üí **Project**
4. Importez `maisongiel-qrcode`
5. Configurez :
   - **Framework Preset** : `Vite`
   - **Root Directory** : `frontend`
   - **Build Command** : `npm run build`
   - **Output Directory** : `dist`

### √âtape 4.2 : Configurer l'URL du Backend

Dans **Settings** ‚Üí **Environment Variables**, ajoutez :

```env
VITE_API_URL=https://maisongiel-backend.onrender.com
```

### √âtape 4.3 : Configurer le domaine personnalis√©

1. Allez dans **Settings** ‚Üí **Domains**
2. Ajoutez `maisongiel.net`
3. Suivez les instructions pour configurer vos DNS chez votre registrar (OVH, Gandi, etc.)

Configurez ces enregistrements DNS :
```
Type: A
Name: @
Value: 76.76.21.21

Type: CNAME
Name: www
Value: cname.vercel-dns.com
```

### √âtape 4.4 : Mettre √† jour l'API frontend

Modifiez `frontend/src/services/api.js` pour utiliser l'URL de production :

```javascript
import axios from 'axios'

const api = axios.create({
  baseURL: import.meta.env.VITE_API_URL || 'http://localhost:3000',
  headers: {
    'Content-Type': 'application/json'
  }
})

export default api
```

### √âtape 4.5 : D√©ployer

1. Cliquez sur **Deploy**
2. Vercel va automatiquement builder et d√©ployer
3. Votre site sera accessible sur `https://maisongiel.net` une fois les DNS propag√©s (24-48h max)

---

## 5Ô∏è‚É£ CONFIGURATION FINALE

### Sur Render (Backend)

Ajoutez cette variable pour autoriser les requ√™tes depuis Vercel :

```env
FRONTEND_URL=https://maisongiel.net
```

### Test de Production

1. Allez sur `https://maisongiel.net`
2. Testez le parcours complet :
   - Inscription
   - Lien d'avis Google
   - Roue de la chance
3. V√©rifiez dans Supabase (Table Editor) que les donn√©es apparaissent bien

---

## üîÑ Workflow de Mise √† Jour

### Pour d√©ployer de nouvelles modifications :

```bash
# 1. Faire vos modifications localement
git add .
git commit -m "Description de vos changements"
git push

# 2. Render et Vercel vont automatiquement red√©ployer !
```

---

## ‚öôÔ∏è Auto-D√©ploiement Activ√©

‚úÖ **GitHub** ‚Üí Push du code  
‚úÖ **Render** ‚Üí Red√©ploiement automatique du backend  
‚úÖ **Vercel** ‚Üí Red√©ploiement automatique du frontend  
‚úÖ **Supabase** ‚Üí Donn√©es persistantes √† l'infini

---

## üÜò D√©pannage

### "ERR_CONNECTION_REFUSED" sur le site

- V√©rifiez que le backend Render est bien d√©marr√© (vert)
- V√©rifiez que `VITE_API_URL` est bien configur√© dans Vercel

### "Session introuvable"

- V√©rifiez que Supabase est bien connect√© (logs Render)
- V√©rifiez que la table `participations` existe dans Supabase

### Donn√©es ne s'enregistrent pas dans Supabase

- V√©rifiez les variables `SUPABASE_URL` et `SUPABASE_SERVICE_ROLE_KEY` sur Render
- Regardez les logs Render pour voir les erreurs Supabase

---

## üìä Monitoring

- **Render** : Logs backend en temps r√©el
- **Vercel** : Analytics et performance frontend
- **Supabase** : Table Editor pour voir les donn√©es en direct

---

‚ú® **Votre application est maintenant en production mondiale !**
